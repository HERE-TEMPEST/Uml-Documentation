# Диаграмма состояний

### Содержание

- [Понятие](#понятие)
- [Базовые понятия](#базовые-понятия)
- [Общие свойства](#общие-свойства)
- [Содержимое](#содержимое)
- [Общее применение](#общее-применение)
- [Типичные приемы проектирования](#типичные-приемы-проектирования)
  - [Моделирование реактивных объектов](#моделирование-реактивных-объектов)
  - [Прямое обратное и проектирование](#прямое-обратное-и-проектирование)
- [Советы и подсказки](#советы-и-подсказки)
  - [Хорошо структурированная диаграмма состояний обладает следующими характеристиками](#хорошо-структурированная-диаграмма-состояний-обладает-следующими-характеристиками)
  - [Когда вы рисуете диаграмму состояний, пользуйтесь следующими рекомендациями](#когда-вы-рисуете-диаграмму-состояний-пользуйтесь-следующими-рекомендациями)

## Понятие

**`Диаграмма состояний`** – это один из пяти видов диаграмм, предназначенных для моделирования динамических аспектов поведения систем. Диаграмма состояний показывает конечный автомат. И диаграммы деятельности, и диаграммы состояний подходят для моделирования жизненного цикла объекта. Однако в то время, как диаграмма деятельности демонстрирует поток управления от одной деятельности к другой через множество объектов, диаграмма состояний отображает поток управления от состояния к состоянию внутри отдельного объекта.

Диаграммы состояния применяются для моделирования динамических аспектов поведения систем (в большинстве случаев это моделирование поведения реактивных объектов). Реактивным называется такой объект, поведение которого лучше всего характеризуется его реакцией на события, получаемые им извне его контекста. Реактивный объект имеет четкое время жизни, и его текущее поведение зависит от прошлого, Диаграммы состояний могут быть присоединены к классам, вариантам использования либо ко всей системе с целью визуализации, специфицирования, конструирования и документирования динамики отдельных объектов.

Диаграммы состояний полезны не только для моделирования динамических аспектов системы, но и для конструирования исполняемых систем посредством прямого и обратного проектирования.

## Базовые понятия

[**`Диаграмма состояний` (англ. state diagram)**](./README.md) показывает автомат, сосредотачивая внимание на потоке управления от одного состояния к друтому. Изображается в виде графа с вершинами и дугами (ребрами).

[**`Автомат` (англ. state machine)**](./state-machine.md) — это описание последовательности состояний, через которые проходит объект на протяжении жизненого цикла, реагируя на события, а также описание реакции на эти события.

[**`Состояние` (англ. state)**](./state.md) — ситуация в жизненном цикле объекта, на про-тяжении которой он удовлетворяет некоторому условию, выполняетекоторую деятельность или ожидает некоторого события.

[**`Событие` (англ. event)**](./event.md) — спецификация существенного факта, который происходит во времени и пространстве. В контексте автомата событие — это воздействие, которое вызывает переход между состояниями.

[**`Переход` (англ. transition)**](./transition.md) — связь между двумя состояниями, показывающая, что объект, находящийся в первом состоянии, должен выполнить некоторые действия и перейти во второе, как только, произойдет определенное событие и будут выполнены определные условия.

[**`Деятельность` (англ. activity)**](./activity.md) специфицирует работу, происходящую внутри автомата.

[**`Действие` (англ. action)**](./action.md) —примитивное выполняемое вычисление, приводящее к смене состояния модели или возврату значения.

> **`На заметку.`** Диаграммы состояний, используемые в УМЕ, основаны на нотации, предложенной Дэвидом Харелом (Бам@ Наге!). В частности, концепции вложенных и ортогональных состояний были подробно разработаны Харелом в виде формальной системы. В УМЬ эти концепции менее формализованны, чем в нотации Харела, и отличаются некоторыми деталями в частности, сосредотачивая внимание на объектно-ориентированных системах.

## Общие свойства

Диаграмма состояний обладает свойствами, общими для всех диаграмм: имеет имя и графическое содержимое, представляющее собой проекцию модели. От прочих диаграмм она отличается именно своим содержимым.

## Содержимое

Диаграммы состояния обычно содержат простые и составные состояния, а также переходы, события и действия. Кроме того, как и все диаграммы, могут включать комментарии и ограничения.

> **`На заметку.`** Диаграмма состояний, по сути, состоит из элементов, встречающихся в любом автомате. Она может содержать ветвления, разделения, соединения, состояния действий и состояния деятельности, объекты, начальные и конечные состояния, исторические состояния и т.д. в - общем, на диаграмме состояний отображаются все без исключения характеристики автомата.

## Общее применение

Диаграммы состояний применяются для моделирования динамических аспектов поведения системы. Имеется в виду обусловленное порядком возникновения событий поведение объектов любого рода в любом представлении системной архитектуры, включая классы (в т.ч. активные), интерфейсы, компоненты и узлы.

Диаграммы состояний можно использовать для моделирования некоторого динамического аспекта системы, притом в контексте почти любого элемента модели. Однако чаще их применяют в контексте всей системы, подсистемы либо класса. Также диаграммы состояний можно присоединять к вариантам использования (для моделирования сценариев).

При моделировании динамических аспектов системы, класса или варианта использования диаграммы состояний обычно применяются для моделирования реактивных объектов.

_`Реактивный`_ (reactive), или _`управляемый событиями`_, объект — такой, поведение которого лучше всего характеризуется его реакцией на события, принимаемые им извне его контекста. Обычно реактивный объект простаивает в ожидании события. Когда он получает это событие, его реакция обычно зависит от предыдущих событий. 'Отреагировав определенным образом, объект опять возвращается в состояние простоя, ожидая следующего события. Рассматривая объект подобного рода, вы сосредотачиваете внимание на его стабильных состояниях, событиях, инициирующих переходы от одного состояния к другому, а также действиях, которые выполняются при каждой смене состояния.

> **`На заметку.`** В отличие от диаграмм состояний, диаграммы действий применяются для моделирования потока. работ или моделирования операций. Диаграммы деятельности лучше подходят для моделирования потока деятельности во времени, как это представляется на блок-схемах.

## Типичные приемы проектирования

### Моделирование реактивных объектов

Чаще всего, как уже было сказано, диаграммы состояний используются при моделировании поведения реактивных объектов, особенно экземпляров классов, вариантов использования и системы в целом. В то время как взаимодействия моделируют поведение сообщества объектов, работающих вместе, диаграмма состояний моделирует поведение отдельного объекта во время его жизненного цикла. В отличие от диаграмм деятельности, которые моделируют поток управления от одной деятельности к другой, диаграмма состояний моделирует поток управления от одного события к другому.

При моделировании поведения реактивного объекта, по сути, специфицируются три вещи: стабильные состояния, в которых объект может пребывать, события, вызывающие переходы от стояния к состоянию, и действия, выполняемые при каждой смене состояний. Кроме того, моделирование поведения реактивного объекта подразумевает моделирование его жизненного цикла начиная с создания объекта вплоть до его уничтожения, с выделением стабильных состояний, в которых он может находиться.

Стабильное состояние представляет условие, при котором объект может существовать в течение некоторого определенного периода времени. Когда происходит событие, объект может переходить из одного состояния в другое. Эти события также могут вызывать переходы в себя и внутренние переходы, когда исходное и целевое состояния объекта совпадают. Реагируя на события и изменения состояния, объект может выполнять действия.

> **`На заметку.`** Когда моделируется поведение реактивного объекта, можно специфицировать его действия, привязывая их к переходу или смене состояния. В технической терминологии автомат, все действия которого привязаны к переходам, называется машиной Мили (Мез!у таспте), а автомат, действия которого привязаны к состояниям, - машиной Мура (Мооге таспте). В математическом плане эти два варианта эквивалентны по мощности. На практике чаще создаются диаграммы состояний, использующие некоторую комбинацию машин Мили и Мура.

Чтобы смоделировать реактивный объект, необходимо:

- Выбрать контекст автомата — класс, вариант использования или систему в целом.
- Установить начальное и конечное состояния объекта. Возможно, чтобы управлять остальными частями модели, понадобится также установить пред- и постусловия начального и конечного состояний соответственно.
- Принять решения относительно стабильных состояний объекта, рассмотрев условия, в которых объект может существовать
  в течение определенного периода времени. Начать с состояний высшего уровня и только после этого перейти к рассмотрению возможных подсостояний.
- Принять решения относительно осмысленного частичного упорядочения состояний на протяжении времени жизни объекта.
- Принять решения относительно событий, которые могут вызывать переходы из одного состояния в другое. Смоделировать, эти события как триггеры переходов между состояниями.
- Присоединить действия к переходам (как в машине Мили) и/или к состояниям (как в машине Мура).
- Рассмотреть возможности упрощения автомата за счет применения подсостояний, ветвления, разделений, соединений и исторических состояний
- Убедиться, что все состояния достижимы при некотором стечении событий.
- Проверить, нет ли каких-нибудь «мертвых» состояний, из которых объект не сможет выйти ни при каком сочетании событий
- Провести трассировку автомата (либо вручную, либо с применением инструментальных средств), чтобы подтвердить соответствие ожидаемым последовательностям событий и реакциям на них.

### Прямое обратное и проектирование

**`Прямое проектирование`** (создание кода из модели) возможно для диаграммы состояний, особенно если контекстом таковой является класс. Анализ такого кода требует небольшого напряжения ума. Инс трумент прямого проектирования должен генерировать необходимые закрытые атрибуты и конечные статические константы.

**`Обратное проектирование`** (создание модели из кода) теоретически возможно, но практически не очень полезно. Выбор того, что составляет осмысленное состояние объекта, зависит от взгляда проектировщика. Инструменты обратного проектирования не обладают способностью к абстрагированию, а потому не могут генерировать осмысленные диаграммы состояний. Более интересной, чем обратное проектирование модели из кода, может оказаться анимация модели на основе работы реальной системы.

## Советы и подсказки

Создавая диаграмму состояний в ИМТ, следует помнить, что она представляет собой всего лишь проекцию одной модели динаических аспектов системы. Отдельно взятая диаграмма состояний может охватить семантику одного реактивного объекта, но семантику непростой системы не в состоянии передать.

### Хорошо структурированная диаграмма состояний обладает следующими характеристиками:

- сосредоточена на передаче одного аспекта динамики системы;
- содержит только те элементы, которые существенны для понимания данного аспекта;
- детализирована адекватно своему уровню абстракции (раскрывает только те сущности, которые важны для понимания);
- применяет сбалансированное сочетание машин Мили и Мура.

### Когда вы рисуете диаграмму состояний, пользуйтесь следующими рекомендациями:

- присваивайте диаграмме имя, отражающее ее назначение;
- начинайте с моделирования стабильных состояний объекта, затем моделируйте допустимые переходы между состояниями. Показывайте ветвление, параллелизм и потоки объектов во вторую очередь — возможно, на отдельных диаграмма:
- располагайте элементы так, чтобы свести к минимуму пересечение линий;
- при создании объемных диаграмм состояний рассмотрите возможность применения расширенных средств — таких как вложенные автоматы, которые включены в полную спецификацию UML.

[<< На главную](../README.md)
